<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ë–æ—Ç –¢–µ—Å—Ç–µ—Ä</title>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background-color: #f4f4f9; color: #333; max-width: 1000px; margin: 0 auto; padding: 20px; }
        h1 { color: #2c3e50; }
        .container { display: flex; gap: 20px; }
        .controls { flex: 1; background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        .logs-panel { flex: 2; background: #2b2b2b; color: #f1f1f1; padding: 20px; border-radius: 8px; height: 500px; overflow-y: auto; font-family: monospace; }
        
        button {
            display: block;
            width: 100%;
            padding: 10px;
            margin-bottom: 10px;
            border: none;
            border-radius: 4px;
            background-color: #3498db;
            color: white;
            cursor: pointer;
            font-size: 16px;
            transition: background 0.3s;
        }
        button:hover { background-color: #2980b9; }
        button.run-all { background-color: #27ae60; font-weight: bold; }
        button.run-all:hover { background-color: #219150; }

        .log-entry { margin-bottom: 5px; border-bottom: 1px solid #444; padding-bottom: 2px; }
        .log-error { color: #e74c3c; font-weight: bold; }
        .log-info { color: #2ecc71; }
    </style>
</head>
<body>

    <h1>ü§ñ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ Telegram –ë–æ—Ç–∞</h1>
    
    <div class="container">
        <div class="controls">
            <h3>–°—Ü–µ–Ω–∞—Ä–∏–∏</h3>
            <button class="run-all" onclick="runTest('all')">‚ñ∂ –ó–∞–ø—É—Å—Ç–∏—Ç—å –í–°–ï —Å—Ü–µ–Ω–∞—Ä–∏–∏</button>
            <hr>
            {% for scenario in scenarios %}
            <button onclick="runTest('{{ scenario }}')">‚ñ∂ {{ scenario }}</button>
            {% endfor %}
            
            <div style="margin-top: 30px; font-size: 0.9em; color: #777;">
                <p>–î–æ–±–∞–≤—å—Ç–µ –Ω–æ–≤—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏ –≤ <code>scenarios.csv</code> –∏ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É.</p>
            </div>
        </div>

        <div class="logs-panel" id="log-container">
            <div>–û–∂–∏–¥–∞–Ω–∏–µ –∑–∞–ø—É—Å–∫–∞...</div>
        </div>
    </div>

    <script>
        // –§—É–Ω–∫—Ü–∏—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –∑–∞–ø—Ä–æ—Å–∞ –Ω–∞ –∑–∞–ø—É—Å–∫
        async function runTest(scenarioName) {
            const logContainer = document.getElementById('log-container');
            logContainer.innerHTML = `<div class="log-info">--- –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∑–∞–ø—É—Å–∫–∞: ${scenarioName} ---</div>`;
            
            try {
                const response = await fetch(`/run/${encodeURIComponent(scenarioName)}`, { method: 'POST' });
                const data = await response.json();
                console.log(data);
            } catch (error) {
                alert("–û—à–∏–±–∫–∞ –ø—Ä–∏ –≤—ã–∑–æ–≤–µ API: " + error);
            }
        }

        // –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –ø–æ—Ç–æ–∫—É –ª–æ–≥–æ–≤ (Server-Sent Events)
        const evtSource = new EventSource("/logs");
        evtSource.onmessage = function(event) {
            const logContainer = document.getElementById('log-container');
            const newLog = document.createElement("div");
            newLog.className = "log-entry";
            
            // –†–∞—Å–∫—Ä–∞—Å–∫–∞ –ª–æ–≥–æ–≤
            if (event.data.includes("ERROR")) {
                newLog.classList.add("log-error");
            } else if (event.data.includes("INFO")) {
                newLog.classList.add("log-info");
            }
            
            newLog.textContent = event.data;
            logContainer.appendChild(newLog);
            
            // –ê–≤—Ç–æ–ø—Ä–æ–∫—Ä—É—Ç–∫–∞ –≤–Ω–∏–∑
            logContainer.scrollTop = logContainer.scrollHeight;
        };
    </script>

</body>
</html>